@model IEnumerable<Shusha_project_BackUp.Data.TraderSales>

@{
    ViewData["Title"] = "سجل المبيعات";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<style>
    :root {
        --primary-color: #0d6efd;
        --success-color: #198754;
        --info-color: #0dcaf0;
        --warning-color: #ffc107;
        --danger-color: #dc3545;
        --white-egg-color: #e8f4f8;
        --brown-egg-color: #d4a574;
        --double-egg-color: #f0e68c;
    }

    .page-header {
        background: linear-gradient(135deg, var(--primary-color) 0%, #0a58ca 100%);
        color: white;
        padding: 2rem 0;
        margin-bottom: 2rem;
        border-radius: 0.5rem;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    .page-header h1 {
        margin: 0;
        font-weight: 700;
        font-size: 2.5rem;
    }

    .stats-card {
        transition: all 0.3s ease;
        border: none;
        border-radius: 1rem;
        overflow: hidden;
        height: 100%;
    }

    .stats-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 16px rgba(0, 0, 0, 0.15);
    }

    .stats-card .card-header {
        font-weight: 600;
        font-size: 1.1rem;
        padding: 1rem;
    }

    .stats-card .card-body {
        padding: 1.5rem;
    }

    .egg-type-card {
        background: white;
        border-radius: 0.75rem;
        padding: 1.25rem;
        border: 2px solid #e9ecef;
        transition: all 0.3s ease;
    }

    .egg-type-card:hover {
        border-color: var(--primary-color);
        box-shadow: 0 4px 12px rgba(13, 110, 253, 0.15);
    }

    .egg-type-card.white {
        background: linear-gradient(135deg, #ffffff 0%, var(--white-egg-color) 100%);
    }

    .egg-type-card.brown {
        background: linear-gradient(135deg, #fff5e6 0%, #ffe4cc 100%);
    }

    .egg-type-card.double {
        background: linear-gradient(135deg, #fffef0 0%, #fff9d9 100%);
    }

    .egg-type-card h6 {
        font-size: 1.1rem;
        margin-bottom: 1rem;
        font-weight: 700;
    }

    .egg-type-card p {
        margin: 0.5rem 0;
        font-size: 0.95rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .egg-type-card p strong {
        color: #495057;
    }

    .filter-section {
        background: white;
        padding: 1.5rem;
        border-radius: 1rem;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        margin-bottom: 1.5rem;
    }

    .filter-section label {
        font-weight: 600;
        color: #495057;
        margin-bottom: 0.5rem;
    }

    .btn-action {
        padding: 0.75rem 1.5rem;
        font-weight: 600;
        border-radius: 0.5rem;
        transition: all 0.3s ease;
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
    }

    .btn-action:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }

    .table-container {
        background: white;
        border-radius: 1rem;
        padding: 1.5rem;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        overflow-x: auto;
        max-height: 600px;
        overflow-y: auto;
        position: relative;
    }
    
    .table-container::-webkit-scrollbar {
        width: 8px;
        height: 8px;
    }
    
    .table-container::-webkit-scrollbar-track {
        background: #f1f1f1;
        border-radius: 10px;
    }
    
    .table-container::-webkit-scrollbar-thumb {
        background: #888;
        border-radius: 10px;
    }
    
    .table-container::-webkit-scrollbar-thumb:hover {
        background: #555;
    }

    #traderSalesTable {
        margin: 0;
        font-size: 0.9rem;
    }

    #traderSalesTable thead th {
        background: linear-gradient(135deg, #212529 0%, #343a40 100%);
        color: white;
        font-weight: 600;
        padding: 0.75rem 0.5rem;
        white-space: nowrap;
        border: none;
        position: sticky;
        z-index: 10;
        vertical-align: middle;
        text-align: center;
    }
    
    #traderSalesTable thead tr:first-child th {
        top: 0;
        font-size: 1rem;
        padding: 1rem 0.5rem;
        border-bottom: 2px solid rgba(255, 255, 255, 0.2);
    }
    
    #traderSalesTable thead tr:nth-child(2) th {
        top: 54px;
        font-size: 0.9rem;
        padding: 0.75rem 0.5rem;
        border-bottom: 1px solid rgba(255, 255, 255, 0.2);
    }
    
    #traderSalesTable thead tr:nth-child(3) th {
        top: 100px;
        font-size: 0.85rem;
        padding: 0.6rem 0.5rem;
    }
    
    .header-white {
        background: linear-gradient(135deg, #0d6efd 0%, #0a58ca 100%) !important;
    }
    
    .header-brown {
        background: linear-gradient(135deg, #8b5a2b 0%, #6d4623 100%) !important;
    }
    
    .header-double {
        background: linear-gradient(135deg, #ffc107 0%, #e0a800 100%) !important;
        color: #000 !important;
    }
    
    .header-broken {
        background: linear-gradient(135deg, #dc3545 0%, #b02a37 100%) !important;
    }
    
    .header-info {
        background: linear-gradient(135deg, #6c757d 0%, #565e64 100%) !important;
    }

    #traderSalesTable tbody td {
        padding: 0.875rem 0.75rem;
        vertical-align: middle;
        border-bottom: 1px solid #e9ecef;
        text-align: center;
    }

    #traderSalesTable tbody tr {
        transition: background-color 0.2s ease;
    }

    #traderSalesTable tbody tr:hover {
        background-color: #f8f9fa;
    }

    .summary-card {
        background: white;
        border-radius: 1rem;
        padding: 1.5rem;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        transition: all 0.3s ease;
        border-left: 4px solid var(--primary-color);
    }

    .summary-card:hover {
        transform: translateY(-3px);
        box-shadow: 0 6px 16px rgba(0, 0, 0, 0.12);
    }

    .summary-card h5 {
        font-size: 0.95rem;
        color: #6c757d;
        margin-bottom: 0.75rem;
        font-weight: 600;
    }

    .summary-card h3 {
        font-size: 2rem;
        margin: 0;
    }

    .badge-paid {
        background: var(--success-color);
        color: white;
        padding: 0.35rem 0.75rem;
        border-radius: 0.5rem;
        font-weight: 600;
        font-size: 0.85rem;
    }

    .badge-unpaid {
        background: var(--danger-color);
        color: white;
        padding: 0.35rem 0.75rem;
        border-radius: 0.5rem;
        font-weight: 600;
        font-size: 0.85rem;
    }

    .action-buttons {
        display: flex;
        gap: 0.5rem;
        flex-wrap: nowrap;
        justify-content: center;
    }

    .action-buttons .btn {
        padding: 0.5rem;
        font-size: 1rem;
        border-radius: 0.4rem;
        transition: all 0.2s ease;
        width: 36px;
        height: 36px;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        position: relative;
    }

    .action-buttons .btn:hover {
        transform: scale(1.1);
    }
    
    .action-buttons .btn i {
        margin: 0;
    }

    .icon-text {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
    }

    @@media (max-width: 768px) {
        .page-header h1 {
            font-size: 1.75rem;
        }

        .stats-card {
            margin-bottom: 1rem;
        }

        .summary-card h3 {
            font-size: 1.5rem;
        }
    }
</style>

<div class="page-header text-center">
    <h1>
        <i class="bi bi-clipboard-data"></i>
        سجل مبيعات المزرعة للتجار
    </h1>
</div>

<!-- Today's Sales Summary -->
<div class="stats-card card shadow-sm mb-4">
    <div class="card-header bg-info text-white text-center">
        <i class="bi bi-calendar-day"></i>
        إجمالي مبيعات اليوم
    </div>
    <div class="card-body">
        <div class="row g-3">
            <div class="col-md-4">
                <div class="egg-type-card white">
                    <h6 class="text-primary">
                        <i class="bi bi-egg"></i>
                        البيض الأبيض
                    </h6>
                    <p><strong>كبير:</strong> <span class="badge bg-primary">@ViewBag.TodayWhite</span></p>
                    <p><strong>جديد:</strong> <span class="badge bg-primary">@ViewBag.TodayNewWhite</span></p>
                    <p><strong>وسط:</strong> <span class="badge bg-primary">@ViewBag.TodayMedWhite</span></p>
                </div>
            </div>

            <div class="col-md-4">
                <div class="egg-type-card brown">
                    <h6 style="color: #8b5a2b;">
                        <i class="bi bi-egg-fill"></i>
                        البيض البني
                    </h6>
                    <p><strong>كبير:</strong> <span class="badge" style="background-color: #8b5a2b;">@ViewBag.TodayBrown</span></p>
                    <p><strong>جديد:</strong> <span class="badge" style="background-color: #8b5a2b;">@ViewBag.TodayNewBrown</span></p>
                    <p><strong>وسط:</strong> <span class="badge" style="background-color: #8b5a2b;">@ViewBag.TodayMedBrown</span></p>
                </div>
            </div>

            <div class="col-md-4">
                <div class="egg-type-card double">
                    <h6 class="text-warning">
                        <i class="bi bi-egg-fried"></i>
                        البيض المزدوج
                    </h6>
                    <p><strong>كبير:</strong> <span class="badge bg-warning text-dark">@ViewBag.TodayDouble</span></p>
                    <p><strong>جديد:</strong> <span class="badge bg-warning text-dark">@ViewBag.TodayNewDouble</span></p>
                    <p><strong>وسط:</strong> <span class="badge bg-warning text-dark">@ViewBag.TodayMedDouble</span></p>
                </div>
            </div>
        </div>

        <hr class="my-4" />
        
        <div class="row text-center">
            <div class="col-md-6 mb-3">
                <div class="p-3 bg-light rounded">
                    <h5 class="text-muted mb-2">
                        <i class="bi bi-basket3"></i>
                        إجمالي عدد البيض اليوم
                    </h5>
                    <h3 class="text-primary fw-bold mb-0">@ViewBag.TodayTotalEggs</h3>
                </div>
            </div>
            <div class="col-md-6 mb-3">
                <div class="p-3 bg-light rounded">
                    <h5 class="text-muted mb-2">
                        <i class="bi bi-currency-dollar"></i>
                        إجمالي المبيعات اليوم
                    </h5>
                    <h3 class="text-success fw-bold mb-0">@ViewBag.TodayTotalSales.ToString("C")</h3>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Add New Record Button -->
<div class="text-end mb-3">
    <a asp-action="Create" class="btn btn-primary btn-action">
        <i class="bi bi-plus-circle"></i>
        إضافة سجل جديد
    </a>
</div>

<!-- Filter Section -->
<div class="filter-section">
    <form asp-action="Index" method="get" class="row g-3 align-items-end">
        <div class="col-md-3">
            <label for="from" class="form-label">
                <i class="bi bi-calendar-range"></i>
                من تاريخ
            </label>
            <input type="date" id="from" name="from" value="@ViewBag.From" class="form-control" />
        </div>
        <div class="col-md-3">
            <label for="to" class="form-label">
                <i class="bi bi-calendar-range"></i>
                إلى تاريخ
            </label>
            <input type="date" id="to" name="to" value="@ViewBag.To" class="form-control" />
        </div>
        <div class="col-md-3">
            <label for="month" class="form-label">
                <i class="bi bi-calendar-month"></i>
                الشهر
            </label>
            <select id="month" name="month" class="form-select">
                <option value="">-- اختر الشهر --</option>
                @for (int i = 1; i <= 12; i++)
                {
                    <option value="@i" @@(ViewBag.Month == i ? "selected" : "")>
                        @System.Globalization.CultureInfo.GetCultureInfo("ar-EG").DateTimeFormat.GetMonthName(i)
                    </option>
                }
            </select>
        </div>
        <div class="col-md-3">
            <button type="submit" class="btn btn-primary btn-action w-100">
                <i class="bi bi-search"></i>
                بحث
            </button>
        </div>
    </form>
</div>

<!-- Export Button -->
<div class="d-flex justify-content-end mb-3">
    <a asp-action="ExportToExcel"
       asp-route-from="@ViewBag.From"
       asp-route-to="@ViewBag.To"
       asp-route-month="@ViewBag.Month"
       class="btn btn-success btn-action">
        <i class="bi bi-file-earmark-excel"></i>
        تصدير إلى إكسل
    </a>
</div>

<!-- Data Table -->
<div class="table-container">
    <table id="traderSalesTable" class="table table-striped table-hover text-center" style="width:100%">
        <thead>
            <tr>
                <th colspan="6" class="header-white">
                    <i class="bi bi-egg"></i>
                    البيض الأبيض
                </th>
                <th colspan="6" class="header-brown">
                    <i class="bi bi-egg-fill"></i>
                    البيض البني
                </th>
                <th colspan="2" class="header-broken">
                    <i class="bi bi-egg-fried"></i>
                    البيض الكسر
                </th>
                <th colspan="6" class="header-double">
                    <i class="bi bi-egg-fried"></i>
                    البيض المزدوج
                </th>
                <th colspan="5" class="header-info">
                    <i class="bi bi-info-circle"></i>
                    معلومات الطلب
                </th>
            </tr>
            <tr>
                <!-- White Eggs -->
                <th colspan="2" class="header-white">كبير</th>
                <th colspan="2" class="header-white">بشاير</th>
                <th colspan="2" class="header-white">وسط</th>
                
                <!-- Brown Eggs -->
                <th colspan="2" class="header-brown">كبير</th>
                <th colspan="2" class="header-brown">بشاير</th>
                <th colspan="2" class="header-brown">وسط</th>
                
                <!-- Broken Eggs -->
                <th colspan="2" class="header-broken">الكسر</th>
                
                <!-- Double Eggs -->
                <th colspan="2" class="header-double">كبير</th>
                <th colspan="2" class="header-double">بشاير</th>
                <th colspan="2" class="header-double">وسط</th>
                
                <!-- Info Columns -->
                <th class="header-info" rowspan="2"><i class="bi bi-cash-stack"></i><br/>الإجمالي</th>
                <th class="header-info" rowspan="2"><i class="bi bi-check-circle"></i><br/>السداد</th>
                <th class="header-info" rowspan="2"><i class="bi bi-calendar-event"></i><br/>التاريخ</th>
                <th class="header-info" rowspan="2"><i class="bi bi-person-badge"></i><br/>التاجر</th>
                <th class="header-info" rowspan="2"><i class="bi bi-gear"></i><br/>إجراءات</th>
            </tr>
            <tr>
                <!-- White Eggs Data Columns -->
                <th class="header-white"><i class="bi bi-hash"></i></th>
                <th class="header-white"><i class="bi bi-currency-dollar"></i></th>
                <th class="header-white"><i class="bi bi-hash"></i></th>
                <th class="header-white"><i class="bi bi-currency-dollar"></i></th>
                <th class="header-white"><i class="bi bi-hash"></i></th>
                <th class="header-white"><i class="bi bi-currency-dollar"></i></th>
                
                <!-- Brown Eggs Data Columns -->
                <th class="header-brown"><i class="bi bi-hash"></i></th>
                <th class="header-brown"><i class="bi bi-currency-dollar"></i></th>
                <th class="header-brown"><i class="bi bi-hash"></i></th>
                <th class="header-brown"><i class="bi bi-currency-dollar"></i></th>
                <th class="header-brown"><i class="bi bi-hash"></i></th>
                <th class="header-brown"><i class="bi bi-currency-dollar"></i></th>
                
                <!-- Broken Eggs Data Columns -->
                <th class="header-broken"><i class="bi bi-hash"></i></th>
                <th class="header-broken"><i class="bi bi-currency-dollar"></i></th>
                
                <!-- Double Eggs Data Columns -->
                <th class="header-double"><i class="bi bi-hash"></i></th>
                <th class="header-double"><i class="bi bi-currency-dollar"></i></th>
                <th class="header-double"><i class="bi bi-hash"></i></th>
                <th class="header-double"><i class="bi bi-currency-dollar"></i></th>
                <th class="header-double"><i class="bi bi-hash"></i></th>
                <th class="header-double"><i class="bi bi-currency-dollar"></i></th>
            </tr>
        </thead>
        <tbody>
            @foreach (var item in Model)
            {
                <tr>
                    <td>@item.NoOfWhiteEggs</td>
                    <td>@item.WhiteEggPrice.ToString("C")</td>
                    <td>@item.NoOfNewWhiteEggs</td>
                    <td>@item.NewWhiteEggPrice.ToString("C")</td>
                    <td>@item.NoOfMedWhiteEggs</td>
                    <td>@item.MedWhiteEggPrice.ToString("C")</td>
                    <td>@item.NoOfBrownEggs</td>
                    <td>@item.BrownEggPrice.ToString("C")</td>
                    <td>@item.NoOfNewBrownEggs</td>
                    <td>@item.NewBrownEggPrice.ToString("C")</td>
                    <td>@item.NoOfMedBrownEggs</td>
                    <td>@item.BrownMedEggPrice.ToString("C")</td>
                    <td>@item.NoOfBrokenEggs</td>
                    <td>@item.BrokenEggPrice.ToString("C")</td>
                    <td>@item.NoOfDoubleEggs</td>
                    <td>@item.DoubleEggPrice.ToString("C")</td>
                    <td>@item.NoOfNewDoubleEggs</td>
                    <td>@item.NewDoubleEggPrice.ToString("C")</td>
                    <td>@item.NoOfMedDoubleEggs</td>
                    <td>@item.MedDoubleEggPrice.ToString("C")</td>
                    <td><strong>@item.RequestProceed</strong></td>
                    <td>
                        @if (item.IsPaid)
                        {
                            <span class="badge-paid">
                                <i class="bi bi-check-circle-fill"></i>
                                نعم
                            </span>
                        }
                        else
                        {
                            <span class="badge-unpaid">
                                <i class="bi bi-x-circle-fill"></i>
                                لا
                            </span>
                        }
                    </td>
                    <td>@item.date.ToShortDateString()</td>
                    <td><strong>@item.name_ofTrader</strong></td>
                    <td>
                        <div class="action-buttons">
                            <a asp-action="Edit" asp-route-id="@item.Id" class="btn btn-warning btn-sm" title="تعديل" data-bs-toggle="tooltip">
                                <i class="bi bi-pencil-square"></i>
                            </a>
                            <a asp-action="Details" asp-route-id="@item.Id" class="btn btn-info btn-sm" title="تفاصيل" data-bs-toggle="tooltip">
                                <i class="bi bi-info-circle"></i>
                            </a>
                            <a asp-action="Delete" asp-route-id="@item.Id" class="btn btn-danger btn-sm" title="حذف" data-bs-toggle="tooltip">
                                <i class="bi bi-trash"></i>
                            </a>
                        </div>
                    </td>
                </tr>
            }
        </tbody>
    </table>
</div>

<!-- Summary Statistics -->
<div class="container mt-4">
    <div class="row text-center g-3">
        <div class="col-md-4">
            <div class="summary-card" style="border-left-color: var(--info-color);">
                <h5>
                    <i class="bi bi-egg"></i>
                    إجمالي البيض الأبيض
                </h5>
                <h3 class="text-primary fw-bold">@ViewBag.Total_WhEgg</h3>
            </div>
        </div>
        <div class="col-md-4">
            <div class="summary-card" style="border-left-color: #8b5a2b;">
                <h5>
                    <i class="bi bi-egg-fill"></i>
                    إجمالي البيض البني
                </h5>
                <h3 class="fw-bold" style="color: #8b5a2b;">@ViewBag.Total_BrEgg</h3>
            </div>
        </div>
        <div class="col-md-4">
            <div class="summary-card" style="border-left-color: var(--success-color);">
                <h5>
                    <i class="bi bi-basket3-fill"></i>
                    إجمالي البيض
                </h5>
                <h3 class="text-success fw-bold">@ViewBag.Total</h3>
            </div>
        </div>
    </div>

    <div class="row text-center g-3 mt-3">
        <div class="col-md-4">
            <div class="summary-card" style="border-left-color: var(--success-color);">
                <h5>
                    <i class="bi bi-cash-coin"></i>
                    إجمالي مبيعات البيض الأبيض
                </h5>
                <h3 class="text-success fw-bold">@ViewBag.total_Wh_sales</h3>
            </div>
        </div>
        <div class="col-md-4">
            <div class="summary-card" style="border-left-color: var(--success-color);">
                <h5>
                    <i class="bi bi-cash-coin"></i>
                    إجمالي مبيعات البيض البني
                </h5>
                <h3 class="text-success fw-bold">@ViewBag.total_br_sales</h3>
            </div>
        </div>
        <div class="col-md-4">
            <div class="summary-card" style="border-left-color: var(--warning-color);">
                <h5>
                    <i class="bi bi-currency-dollar"></i>
                    إجمالي المبيعات
                </h5>
                <h3 class="text-warning fw-bold">@ViewBag.Total_sales</h3>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.1/css/dataTables.bootstrap5.min.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.1/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.1/js/dataTables.bootstrap5.min.js"></script>
    <script>
        $(document).ready(function() {
            // Initialize DataTables
            $('#traderSalesTable').DataTable({
                "language": {
                    "url": "https://cdn.datatables.net/plug-ins/1.13.1/i18n/ar.json",
                    "emptyTable": "لا توجد بيانات لعرضها",
                    "paginate": {
                        "first": "الأول",
                        "last": "الآخر",
                        "next": "التالي",
                        "previous": "السابق"
                    },
                    "info": "عرض _START_ إلى _END_ من _TOTAL_ سجل",
                    "infoEmpty": "لا توجد بيانات لعرضها",
                    "infoFiltered": "(تم تصفيتها من _MAX_ إجمالي العناصر)",
                    "search": "بحث:",
                    "lengthMenu": "عرض _MENU_ سجل"
                },
                "pagingType": "full_numbers",
                "responsive": true,
                "ordering": true,
                "pageLength": 25,
                "lengthMenu": [[10, 25, 50, 100, -1], [10, 25, 50, 100, "الكل"]],
                "order": [[22, "desc"]], // Sort by date column (index 22) in descending order
                "scrollY": false,
                "scrollCollapse": false
            });
            
            // Initialize Bootstrap tooltips
            var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
            var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
                return new bootstrap.Tooltip(tooltipTriggerEl);
            });
        });
    </script>
}

